<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<script type="text/javascript" src="..\src\hash.js"></script>
		<script type="text/javascript"><!--
			
			function getPageName(page) {
				return page == "" ? "home" : page;
			}
			
			var confirmdielog_cb = null;
			function confirmdielog(yes) {
				document.getElementById("dialog").innerHTML = "";
				if (confirmdielog_cb) confirmdielog_cb(yes ? true : false);
				confirmdielog_cb = null;
			}
			
			var lastPage = "";
			$hash.onexit("*", function(page, delayedcb) {
				var unsaved = document.getElementById("unsaved");
				document.getElementById("status").innerHTML = "Closing page... " + getPageName(page);
				lastPage = page;
				console.log("exit [1] -> \"" + getPageName(page) + "\"");
				//if (page == "products" && unsaved && unsaved.checked == true) {
				if (unsaved && unsaved.checked == true) {
					if (delayedcb) {
						console.log("exit [1b] UNSAVED");
						confirmdielog_cb = delayedcb;
						//document.getElementById("dialog").innerHTML = "Please confirm exit without saving changes <a href='javascript:confirmdielog(true)'>Yes</a> or <a href='javascript:confirmdielog(false)'>No</a>";
						//setTimeout(function() {
						//	delayedcb(false);
						//}, 1500);
						return false;
					} else { // cannot delay callback, this means that onbeforerun happened, so we can simply report/ask the browser to show the confirmation before exit dialog
						console.log("exit [1] UNSAVED");
						return false;
					}
				}
			});
			$hash.onenter("*", function(page, delayedcb) {
				document.getElementById("status").innerHTML = "Entering page... " + getPageName(page);
				console.log("enter [2] -> \"" + getPageName(page) + "\"");
				var unsaved = "";
				if (page == "products") {
					unsaved = "<br><br><label><input type='checkbox' id='unsaved' checked> Unsaved changes in this page.</label>";
				}
				document.getElementById("content").innerHTML = "Section " + getPageName(page) + " page contents rendered @" + new Date().getTime() + unsaved;
				document.getElementById("content").style.padding = "1em";
				document.getElementById("content").style.margin = "1em";
				document.getElementById("content").style.background = "lightgreen";
			});
			$hash.onready("*", function(page, delayedcb) {
				console.log("lastPage = [", lastPage, "]");
				console.log("page = [", page, "]");
				document.getElementById("status").innerHTML = "Page ready.<br>Current section <a href=\"javascript:$hash.replace('#" + page + "')\">" + getPageName(page) + "</a>.<br>Previous visited section <a href=\"javascript:$hash.replace('#" + lastPage + "')\">" + getPageName(lastPage) + "</a>.";
				console.log("ready [3] -> \"" + getPageName(page) + "\"");
			});
		
			console.log("begin");
			
		//--></script>
	</head>
	<body>
		<div id="navmenu">
			GO/BACK
			<a href="javascript:$hash.back()">&lt;</a> | 
			<a href="javascript:$hash.go('#')">Home</a> | 
			<a href="javascript:$hash.go('#products')">Products</a> | 
			<a href="javascript:$hash.go('#contact')">Contact</a>
		</div>
		<div id="navmenu2">
			A HREF
			<a href="javascript:history.back()">&lt;</a> | 
			<a href="#">Home</a> | 
			<a href="#products">Products</a> | 
			<a href="#contact">Contact</a>
		</div>
		<div id="content">
			
		</div>
		<div id="dialog">
			
		</div>
		<div id="status">
			
		</div>
	</body>
</html>